[小程序中可拖动回弹浮窗的一种实现 | 微信开放社区](https://developers.weixin.qq.com/community/develop/article/doc/000c0e3a8c45a8feacae54db751813) 

 ### 实现效果

![](http://mmbiz.qpic.cn/mmbiz_gif/ymuyJKAH0TA7kTpTUyvsEEb9O9EQc700OibTTyBjGEx4wClx815L4dyc5OQD25sTsglzTXgkZXiaBlRASC0siabew/0?wx_fmt=gif)

### 代码实现

```
<view class="container">
  <movable-area>
    <movable-view bind:touchend="onTouchend" x="{{x}}" y="{{y}}" direction="all">
      <view class="float">text</view>
    </movable-view>
  </movable-area>
﻿</view>


```

```
data:{
  x: wx.getSystemInfoSync().windowWidth - 60, 
  y: wx.getSystemInfoSync().windowHeight - 120, 
  windowWidth: wx.getSystemInfoSync().windowWidth
}
onTouchend(e) {
  
  const currentX = e.changedTouches\[0\].clientX;
  const currentY = e.changedTouches\[0\].clientY;
  wx.createSelectorQuery().select('.float').boundingClientRect().exec((res) => {
    
    console.log(currentX + res\[0\].width / 2 \> this.data.windowWidth / 2, currentX + res\[0\].width <= this.data.windowWidth / 2);
    if (currentX + res\[0\].width / 2 \> this.data.windowWidth / 2) {
      this.setData({
        x: this.data.windowWidth - 20 \- res\[0\].width,
        y: currentY - res\[0\].height / 2 \- 10
      });
    }
    if (currentX + res\[0\].width / 2 <= this.data.windowWidth / 2) {
      this.setData({
        x: 20,
        y: currentY - res\[0\].height / 2 \- 10
      });
    }
  });
  
}
movable-area {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  pointer-events: none;
  z-index: 999;

  movable-view {
    pointer-events: auto; 
  }
}

.float {
  width: 90rpx;
  height: 90rpx;
  border-radius: 99em;
  background: pink;
}

```

### 简单封装为组件使用

**使用**

![](http://mmbiz.qpic.cn/mmbiz_gif/ymuyJKAH0TA7kTpTUyvsEEb9O9EQc7000kDdkQQtxrNWXKgVxdos47JdPaIziayH6gArTCj1tibtT1TDnWzqqP9A/0?wx_fmt=gif)

```
2342

.float {
  width: 100rpx;
  height: 100rpx;
  border-radius: 99em;
  background: pink;
}

```

**组件**

```
Component({
  
  properties: {
    position: {
      type: Object,
      value: {
        left: 0,
        right: 0,
        bottom: 0,
        top: 0
      } 
    },
    left: {
      type: Number,
      value: 0
    },
    right: {
      type: Number,
      value: 0
    },
    top: {
      type: Number,
      value: 0
    },
    bottom: {
      type: Number,
      value: 0
    },
    h_margin: { 
      type: Number,
      value: 20
    },
    v_margin: { 
      type: Number,
      value: 20
    }
  },
  data: {
    x: 999,
    y: 999,
    windowWidth: wx.getSystemInfoSync().windowWidth,
    windowHeight: wx.getSystemInfoSync().windowHeight,
    elementWidth: 0,
    elementHeight: 0
  },
  lifetimes: {
    attached() {
      
      wx.createSelectorQuery().in(this).select('.com-float-box').boundingClientRect().exec((res) => {
        console.log(res);
        this.data.elementWidth = res\[0\].width;
        this.data.elementHeight = res\[0\].height;
        if (this.properties.position.left || this.properties.left) {
          this.data.x = this.properties.position.left || this.properties.left;
        }
        if (this.properties.position.right || this.properties.right) {
          this.data.x = this.data.windowWidth - this.data.elementWidth - (this.properties.position.right ? this.properties.position.right : this.properties.right);
        }
        if (this.properties.position.bottom || this.properties.bottom) {
          this.data.y = this.data.windowHeight - this.data.elementHeight - (this.properties.position.bottom ? this.properties.position.bottom : this.properties.bottom);
        }
        if (this.properties.position.top || this.properties.top) {
          this.data.y = this.properties.position.top || this.properties.top;
        }
        this.setData({
          elementWidth: this.data.elementWidth,
          elementHeight: this.data.elementHeight,
          x: this.data.x,
          y: this.data.y
        });
      });
    }
  },

  
  methods: {
    onTouchend(e) {
      console.log(e);
      const currentX = e.changedTouches\[0\].clientX;
      let currentY = e.changedTouches\[0\].clientY;
      if (currentY <= this.properties.v_margin) {
        currentY = this.properties.v_margin;
      }
      if (currentY > this.data.windowHeight - this.properties.v_margin) {
        currentY = this.data.windowHeight - this.properties.v_margin;
      }
      if (currentX + this.data.elementWidth / 2 \> this.data.windowWidth / 2) {
        this.setData({
          x: this.data.windowWidth - this.properties.h_margin - this.data.elementWidth,
          y: currentY - this.data.elementHeight / 2 \- 10
        });
      }
      if (currentX + this.data.elementWidth / 2 <= this.data.windowWidth / 2) {
        this.setData({
          x: this.properties.h_margin,
          y: currentY - this.data.elementHeight / 2 \- 10
        });
      }
    }
  }
});

movable-area {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  pointer-events: none;
  z-index: 999;

  movable-view {
    pointer-events: auto; 
  }

  .com-float-box {
    display: inline-block;
  }
}



{
  "component": true,
  "usingComponents": {}
}

```
