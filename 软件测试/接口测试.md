# 1. 接口测试介绍

## 2.1 单元测试

1. 单元测试是应用程序的最小可测试部分。
2. 在面向过程编程中，单元也可以是整个模块，但常见的是单个函数或过程。
3. 在面向对象编程中，单元通常是整个接口，例如类，但可以是单独的方法。
4. 单元测试多数情况下是由程序员自己完成的。

## 2.2 模块测试

1. 首先，这段定义认为模块测试与单元测试有细微的区别。
2. 模块测试是针对具有明显的功能特征的代码块进行的测试。
3. 并且，它认为单元测试可能只涉及测试一小部分的功能。
4. 模块测试多数情况下由其它程序员或测试人员进行。

单元测试更强调的是程序的**最小可测试单元**；而且模块测试更强调所测试程序的**功能完整性**

**模块接口测试**
>对于这个叫法并没有找到规范的概念，它更多的只是一个口头概念。其实它就是模块测试，加上“接口”两个字，更强调了被测试的模块有规范的输入和输出。因为这是一个可测试的模块最显著的特征之一

## 2.3 接口分类

1. 程序接口，也可以看作是程序模块接口，具体到程序中一般就是提供了输入输出的类、方法或函数。对于程序接口的测试，一般需要使用与开发程序接口相同的编程语言，通过不同的传入不同的参数，来验证程序接口的功能。

2. 协议接口，一般指系统通过不同的协议来提供的接口，例如 HTTP/SOAP 协议等。这种类型接口对底层代码做了封装，通过协议的方式对外提供调用。因为不涉及到程序层面，所以，不受编程语言的限制；我们可以通过其它编程语言或工具对其进行测试。

1. 系统与系统之间的
   
系统与系统之间的接口，这里可以是公司内部不同系统之间的接口调用，也可以是不同公司之间系统接口的调用。而对于公司的其它系统，如社区网站和微信活动可以调用这些接口快速的实现相应的功能。而对于后者来说，如微信，微博所提供的第三方登录接口，如果你开发的系统不想自建用户体系，完全可以调用这些接口来实现用户的登录。

2. 下层服务对上层服务的接口
- 应用层，从认知上你可以看成是系统所提供的 UI 层功能。对于 Web 系统来说，你可以认为是浏览器页面上所提供的功能，登录、注册、查询、删除等。
- Service 层，可以理解为服务器所提供数据和逻辑的处理。
- DB 层，(Data Base) 数据库主要用来存放数据，例如用户的个人信息，商品的信息等。
  
3. 系统内，服务与服务之间的调用
假设系统开发一个用户查询接口，输入用户名，返回用户信息（性别、年龄、手机号、邮箱地址等），如果用户不存在则返回NULL；现在需要新开发一个用户抽奖的接口，该接口需要用户名和抽奖id，抽奖接口得到用户名后可以调用用户查询接口，如果用户查询接口返回NULL，那么投资接口就可以直接返回用户不存在了。在这个例子中，用户抽奖接口就调用的用户查询接口。

## 2.4 接口测试的意义

1. 更早地发现问题：
测试应该更早地介入到项目开发中，因为越早地发现bug，修复的成本越低。然而功能测试必须等到系统提供可测试的界面才能对系统进行测试。而接口测试可以在功能界面开发出来之前对系统进行测试。系统接口是上层功能的基础，接口测试可以更早更低成本地发现和解决问题。

2. 缩短产品研发周期：
对于产品研发周期来说，如果将所有测试工作都集中在功能测试阶段，那么测试的问题和修复周期就会变长。因为测试可以更早地介入产品开发中，所以，可以有效地控制功能阶段bug的数量；从而有效地缩短产品开发周期。

3. 发现更底层的问题：
系统的有些底层逻辑是在UI功能测试中不太容易触发的，那么这些逻辑可能会存在问题。接口测试可以更容易更全面的测试到这些底层的逻辑。

4. 检查服务器的异常处理能力：
我们通常把前端的验证称为弱验证，因为它很容易被绕过，这个时候如果只站在功能的层面进行测试，就很难发现一些安全的问题。

## 2.5 HTTP与JSON

> 在当前 Web 接口开发中应用最普遍的就是 HTTP 协议，而 Json 是目前非常流行接口数据传输格式之一。

### 2.5.1 HTTP协议的主要特点

1. 支持客户/服务器模式。
简单快速：客户向服务器请求服务时，只需传送请求方法和路径。请求方法常用的有 GET、POST。每种方法规定了客户与服务器联系的类型不同。由于 HTTP 协议简单，使得 HTTP 服务器的程序规模小，因而通信速度很快。

2. 灵活：HTTP 允许传输任意类型的数据对象。正在传输的类型由 Content-Type 加以标记。
   
3. 无连接：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。
   
4. 无状态：HTTP 协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果
后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。

### 2.5.2 HTTP请求类型

请求行以一个方法符号开头，以空格分开，后面跟着请求的 URI 和协议的版本，格式如下：Method Request-URI HTTP-Version CRLF
其中 Method 表示请求方法；Request-URI 是一个统一资源标识符；HTTP-Version 表示请求的 HTTP
协议版本；CRLF 表示回车和换行（除了作为结尾的 CRLF 外，不允许出现单独的 CR 或 LF 字符）。

### 2.5.3 HTTP请求方法

![HTTP请求方法](https://gitee.com/ye_xing_bear/pic-go/raw/master/%E4%B8%AA%E4%BA%BA%E5%9B%BE%E5%BA%8A/http%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95.png)

### 2.5.4状态代码

![状态代码](https://gitee.com/ye_xing_bear/pic-go/raw/master/%E4%B8%AA%E4%BA%BA%E5%9B%BE%E5%BA%8A/%E7%8A%B6%E6%80%81%E7%A0%81.png)

### 2.5.5 常见状态代码

![常见状态代码](https://gitee.com/ye_xing_bear/pic-go/raw/master/%E4%B8%AA%E4%BA%BA%E5%9B%BE%E5%BA%8A/%E5%B8%B8%E8%A7%81%E7%8A%B6%E6%80%81%E4%BB%A3%E7%A0%81.png)

### 2.5.6 请求头信息

> 请求报头允许客户端向服务器端传递请求的附加信息以及客户端自身的信息。

常用的请求报头：
- Accept：请求报头域用于指定客户端接受哪些类型的信息。eg：Accept：image/gif，表明客户端希望接受 GIF 图象格式的资源；Accept：text/html，表明客户端希望接受 html 文本。
- Accept-Encoding：请求报头域类似于 Accept，但是它是用于指定可接受的内容编码。
- Accept-Language：请求报头域类似于 Accept，但是它是用于指定一种自然语言。
- Connection：允许发送指定连接的选项。例如指定连接是连续，或者指定“close”选项，通知服务器，在响应完成后，关闭连接。从 HTTP/1.1 起，默认都开启了 Keep-Alive，保持连接特性。
- Host（发送请求时，该报头域是必需的），Host 请求报头域主要用于指定被请求资源的 Internet 主机和端口号，它通常从 HTTP URL 中提取出来的。
- User-Agent：请求报头域允许客户端将它的操作系统、浏览器和其它属性告诉服务器。不过，这个报头域不是必需的，如果我们自己编写一个浏览器，不使用 User-Agent 请求报头域，那么服务器端就无法得知我们的信息了。

### 2.5.7 响应头信息

> 响应报头允许服务器传递不能放在状态行中的附加响应信息，以及关于服务器的信息和对 Request-URI所标识的资源进行下一步访问的信息。

常用的响应报头：
- Location：响应报头域用于重定向接受者到一个新的位置。Location 响应报头域常用在更换域名的时候。
- Server：响应报头域包含了服务器用来处理请求的软件信息。与 User-Agent 请求报头域是相对应的。
- WWW-Authenticate：响应报头域必须被包含在 401（未授权的）响应消息中，客户端收到 401 响应消息时候，并发送 Authorization 报头域请求服务器对其进行验证时，服务端响应报头就包含该报头域。
- X-Frame-Options: 有三个值：DENY 表示该页面不允许在 frame 中展示，即便是在相同域名的页面中嵌套也不允许。SAMEORIGIN 表示该页面可以在相同域名页面的 frame 中展示。ALLOW-FROM uri 表示该页面可以在指定来源的 frame 中展示。

### 2.5.8 JSON

JSON 指的是 JavaScript 对象表示法（JavaScript Object Notation）
JSON 是轻量级的文本数据交换格式
JSON 独立于语言 *
JSON 具有自我描述性，更易理解
JSON 使用 JavaScript 语法来描述数据对象， 但是 JSON 仍然独立于语言和平台。 JSON 解析器和 JSON库支持不同的编程语言。 

### 2.5.9 JSON数据格式

> JSON 语法是 JavaScript 对象表示法语法的子集。

JSON 数据格式：
{
  "employees": [
    { "firstName":"Bill" ,         "lastName":"Gates" },
    { "firstName":"George" ,  "lastName":"Bush" },
    { "firstName":"Thomas" , "lastName":"Carter" }
 ]
}

数据在名称/值对中。
数据由逗号分隔。
花括号保存对象。
方括号保存数组

## 2.6 接口测试原理

通过测试程序或工具模拟客户端向服务器发送请求报文，服务器接收请求报文后对相应的报文做出处理然后再把应答报文发送给客户端，客户端接收应答报文这一过程（request→response）

## 2.7 接口测试流程

类似于功能测试，需求讨论→评审需求→确定需求→产出接口定义→根据需求文档及接口定义设计测试用例（测试用例主要从业务场景，功能以及异常测试几个方面考虑）→评审用例→执行测试

1. 接口测试的流程其实和功能测试的流程类似，因为接口测试依赖的主要对象也是需求说明书，所以，最初的流程就是参与需求讨论，评审需求。
2. 需求确定以后，开发会根据需求进行接口设计，会产出接口定义，在开发设计过程中，有能力的话，可以给出一些针对设计的建议，提高可测性，针对需求及设计，进行测试计划，测试设计，然后还需要和配管确定测试环境相关的事情。
3. 在开发完成接口定义之后，就根据需求文档及接口定义进行测试用例设计，测试用例设计主要从业务场景，功能，以及异常测试几个方面考虑。
4. 测试用例设计完成后，针对测试用例进行评审，然后，如果开发代码部分可测时，即可进入测试了，因为是部分可测，可能会使用到mock方法。
5. 已有测试代码时，就要进行测试代码的持续集成了，我们是使用hudson来进行持续集成的在项目结束后，会对每个项目进行总结

## 2.8 接口测试数据准备

1. 如果是只测试一次的接口，可以使用硬编码的方式准备测试数据，在写测试代码的时候，使用到什么数据就写什么数据，为了避免数据重复，可能比较多的会用到随机字符或随机数
2. 可以直接通过调用其他API的方式准备测试数据，这种情况在测试最上层服务的时候比较有用，比如测试团购购买服务，就需要准备要购买的团购数据，购买团购的用户数据，这个时候，可以直接调用生产团购的api和生成用户的api直接生成测试数据
3. 使用excel或xml准备测试数据，这种准备测试数据的方式，主要针对对象数据的准备，比如可以将一条团购数据对应excel中的一条数据，因为一般开发都会使用pojo映射，而在准备测试数据的时候，这些pojo对象属性的设置往往是重复和大工作量的，用excel或XML方式准备，则可以减少在代码当中重复去准备这些数据。
4. 也可以使用工具方法的形式去准备测试数据，通过在代码中写工具方法去实现数据生成，而在测试代码中调用工具方法去得到所需数据。

## 2.9 接口测试着眼点

1. 检查接口返回的数据是否与预期的结果一致。
2. 检查接口的容错性，假如传递数据的类型错误时是否可以处理。例如上面的例子是支持整数，传递的是小数或字符串呢？
3. 接口参数的边界值。例如，传递的参数足够大或为负数时，接口是否可以正常处理。
4. 接口的性能，接口处理数据的时间也是测试的一个方面。牵扯到内部就是算法与代码的优化。
5. 接口的安全性，如果是外部接口的话，这点尤为重要。

## 2.10 接口用例设计

输入参数测试：
1. 针对输入的参数进行测试，也可以说是假定接口参数的不正确性进行的测试，确保接口对任意类型的输入都做了相应的处理：输入参数合法，输入参数不合法，输入参数为空，输入参数为null，输入参数超长；
2. 功能测试：接口是否满足了所提供的功能，相当于是正常情况测试，如果一个接口功能复杂时推荐对接口用例进行结构划分，这样子用例具有更好的可读性和维护性；
3. 逻辑测试：逻辑测试严格讲应为单元测试，单元测试应保持内部逻辑的正确性，可单元测试和接口测试界限并不是那么清楚，所以我们也可以从给出的设计文档中考虑内部逻辑错误的分支情况和异常；
4. 异常情况测试：接口实现是否对异常情况都进行了处理，接口输入参数虽然合法，但是在接口实现中，也会出现异常，因为内部的异常不一定是输入的数据造成的，而有可能是其他逻辑造成的，程序需要对任何的异常都进行处理。

## 2.11 接口测试工具

用于接口测试的工具非常多，在开始介绍接口测试工具之前，大致分为以下几类。
接口测试工具：这类工具比较简单，可以模拟和发送 HTTP 请求，并显示返回数据。返回的数据由人工来检查正确性。例如 Poster、Postman 等。

接口自动化测试工具：相比接口测试要工具，功能要更加强大，一般提供用例的批量执行，返回结果的断言以及测试报告的生成等，如 Jmeter、 Robot Framework、soapUI 等。

接口性能测试工具：主要用于测试接口的性能测试，验证接口处理并发的能力。如 Jmeter、LoadRunner、soapUI 等工具。

# 2. 接口测试分类

# 3. 接口测试要点

# 4. 接口测试流程

# 5. 接口处测试用例设计

# 6. 接口测试工具